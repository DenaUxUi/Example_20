# –≠—Ç–∞–ø 1: –°–±–æ—Ä–∫–∞ Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
FROM golang:1.24 AS builder

WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º Go-—Ñ–∞–π–ª—ã
COPY go.mod go.sum ./
RUN go mod download

COPY . .

# –°–æ–±–∏—Ä–∞–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
RUN go build -o server main.go

# –≠—Ç–∞–ø 2: –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
FROM debian:bookworm-slim

WORKDIR /app

# üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
RUN apt-get update && apt-get install -y ca-certificates && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä—É–µ–º –±–∏–Ω–∞—Ä–Ω–∏–∫
COPY --from=builder /app/server .

# –ö–æ–ø–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –æ–Ω–∏ –Ω—É–∂–Ω—ã)
COPY static/ ./static

EXPOSE 8080

CMD ["./server"]

